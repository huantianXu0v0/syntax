import{r as e,o as a,b as l,w as s,t,s as c,i as n,a as i,h as o,j as u,n as d,f as r,l as f,F as m,G as _,A as p,p as v,q as g,O as k,u as y,P as h,Q as b}from"./index-izamIF4t.js";import{P as C}from"./PcNavbar.BqnQAoPn.js";import{g as w}from"./cloud.DKwZ7jLR.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./store.-x3VDdyk.js";const x=F({__name:"admin",setup(F){const x=w("feedback-co"),R=e([]),j=e(!0),A=e(""),P=e(!1),L=e(""),T=e(null),S=e(!1),U=["bugå·²ç»ä¿®å¤ï¼Œæ‚¨çš„åé¦ˆæ˜¯æˆ‘ä»¬å‰è¿›çš„åŠ¨åŠ›--æ¬¢è¿Žâ”(*ï½€âˆ€Â´*)ãƒŽäº»! ä½ èƒ½å¤Ÿæœ‰ä¸€ä¸ªè‰¯å¥½çš„ä½“éªŒï¼","âœ… Thank you for your feedback! We will look into it.","ðŸ› We have confirmed this bug and will fix it in the next version.","ðŸ‘Œ Suggestion noted. Thanks for helping us improve!","ðŸ¤” Could you please provide more details or screenshots?","ðŸŽ‰ This issue has been resolved. Please update to the latest version."],q=async()=>{j.value=!0;try{const e=await x.getAdminFeedbacks({status:A.value});if(0===e.errCode){const a=e.data;let l=[];if(a.forEach((e=>{e.images&&Array.isArray(e.images)&&e.images.length>0&&(l=l.concat(e.images))})),l.length>0){const e=await t.getTempFileURL({fileList:l}),s={};e.fileList.forEach((e=>{s[e.fileID]=e.tempFileURL})),a.forEach((e=>{e.images&&e.images.length>0&&(e.images=e.images.map((e=>s[e]||e)))}))}R.value=a}else c({title:e.errMsg,icon:"none"})}catch(e){console.error("Fetch error:",e),c({title:"Fetch failed",icon:"none"})}finally{j.value=!1}},E=e=>{A.value=e,q()},V=async()=>{if(L.value.trim()){S.value=!0;try{0===(await x.replyFeedback({id:T.value._id,replyContent:L.value})).errCode&&(c({title:"Sent!",icon:"success"}),P.value=!1,q())}finally{S.value=!1}}};return a((()=>{q()})),(e,a)=>{const t=v,c=n,w=b,F=g,x=k;return i(),l(c,{class:"admin-page"},{default:s((()=>[o(C),o(c,{class:"container-xl content"},{default:s((()=>[o(c,{class:"page-header"},{default:s((()=>[o(t,{class:"title"},{default:s((()=>[u("Feedback Console")])),_:1}),o(c,{class:"filter-tabs"},{default:s((()=>[o(c,{class:d(["tab",{active:""===A.value}]),onClick:a[0]||(a[0]=e=>E(""))},{default:s((()=>[u("All")])),_:1},8,["class"]),o(c,{class:d(["tab",{active:0===A.value}]),onClick:a[1]||(a[1]=e=>E(0))},{default:s((()=>[u("Pending")])),_:1},8,["class"]),o(c,{class:d(["tab",{active:2===A.value}]),onClick:a[2]||(a[2]=e=>E(2))},{default:s((()=>[u("Replied")])),_:1},8,["class"])])),_:1})])),_:1}),j.value?(i(),l(c,{key:1,class:"loading"},{default:s((()=>[o(c,{class:"spinner"})])),_:1})):(i(),l(c,{key:0,class:"ticket-list"},{default:s((()=>[(i(!0),r(m,null,f(R.value,(e=>(i(),l(c,{class:"ticket-card",key:e._id},{default:s((()=>[o(c,{class:"t-header"},{default:s((()=>[o(c,{class:"user-info"},{default:s((()=>[o(t,{class:"u-name"},{default:s((()=>[u(y(e.nickname||e.username||e.mobile||"Anonymous"),1)])),_:2},1024),e.contact?(i(),l(t,{key:0,class:"u-contact"},{default:s((()=>[u("(contact-wayï¼š"+y(e.contact)+")",1)])),_:2},1024)):_("",!0)])),_:2},1024),o(c,{class:"t-meta"},{default:s((()=>[o(t,{class:"tag-type"},{default:s((()=>[u(y(e.type),1)])),_:2},1024),o(t,{class:"time"},{default:s((()=>{return[u(y((a=e.create_date,new Date(a).toLocaleString())),1)];var a})),_:2},1024)])),_:2},1024)])),_:2},1024),o(t,{class:"t-content"},{default:s((()=>[u(y(e.content),1)])),_:2},1024),e.images&&e.images.length?(i(),l(c,{key:0,class:"ticket-imgs"},{default:s((()=>[(i(!0),r(m,null,f(e.images,((a,s)=>(i(),l(w,{key:s,src:a,mode:"aspectFill",class:"t-thumb",onClick:p((a=>{return l=e.images,void h({urls:l,current:s});var l}),["stop"])},null,8,["src","onClick"])))),128))])),_:2},1024)):_("",!0),o(c,{class:"t-footer"},{default:s((()=>[o(c,{class:"status-indicator"},{default:s((()=>[o(c,{class:d(["dot",2===e.status?"green":"orange"])},null,8,["class"]),o(t,null,{default:s((()=>[u(y(2===e.status?"Replied":"Pending"),1)])),_:2},1024)])),_:2},1024),2!==e.status?(i(),l(F,{key:0,class:"btn-reply",onClick:a=>(e=>{T.value=e,L.value="",P.value=!0})(e)},{default:s((()=>[u("Reply")])),_:2},1032,["onClick"])):(i(),l(c,{key:1,class:"reply-preview"},{default:s((()=>[o(t,{class:"r-label"},{default:s((()=>[u("You replied:")])),_:1}),u(" "+y(e.reply_content),1)])),_:2},1024))])),_:2},1024)])),_:2},1024)))),128)),0===R.value.length?(i(),l(c,{key:0,class:"empty"},{default:s((()=>[u("No feedbacks found.")])),_:1})):_("",!0)])),_:1}))])),_:1}),P.value?(i(),l(c,{key:0,class:"modal-overlay",onClick:a[6]||(a[6]=e=>P.value=!1)},{default:s((()=>[o(c,{class:"modal-box",onClick:a[5]||(a[5]=p((()=>{}),["stop"]))},{default:s((()=>[o(t,{class:"m-title"},{default:s((()=>[u("Reply to User")])),_:1}),o(c,{class:"quick-tags"},{default:s((()=>[o(c,{class:"q-label"},{default:s((()=>[u("Quick Reply:")])),_:1}),o(c,{class:"tag-list"},{default:s((()=>[(i(),r(m,null,f(U,((e,a)=>o(c,{class:"tag-item",key:a,onClick:a=>(e=>{L.value=e})(e)},{default:s((()=>[u(y(e),1)])),_:2},1032,["onClick"]))),64))])),_:1})])),_:1}),o(x,{class:"m-input",modelValue:L.value,"onUpdate:modelValue":a[3]||(a[3]=e=>L.value=e),placeholder:"Type your response here...",maxlength:"200"},null,8,["modelValue"]),o(c,{class:"m-actions"},{default:s((()=>[o(F,{class:"btn-cancel",onClick:a[4]||(a[4]=e=>P.value=!1)},{default:s((()=>[u("Cancel")])),_:1}),o(F,{class:"btn-send",onClick:V,loading:S.value},{default:s((()=>[u("Send")])),_:1},8,["loading"])])),_:1})])),_:1})])),_:1})):_("",!0)])),_:1})}}},[["__scopeId","data-v-e84610b5"]]);export{x as default};
