import{t as a,r as e,x as s,y as l,b as t,w as o,i as r,a as c,f as n,h as u,u as i,l as d,z as p,A as f,s as m,p as h,I as _,q as g}from"./index-DwZjcXUC.js";import{_ as b}from"./uni-captcha.BU3uENCS.js";import{o as x,r as w}from"./uni-app.es.CIFaVD21.js";import{m as v}from"./store.DEtVyp6z.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./uni-icons.DFbhKlHF.js";const C=y({__name:"login",setup(y){const C=a.importObject("uni-id-co"),k=e(!1),U=e(null),I=e("");x((a=>{a.uniIdRedirectUrl&&(I.value=decodeURIComponent(a.uniIdRedirectUrl))}));const V=s({username:"",password:"",captcha:""}),j=()=>p({url:"/pages/index/index"}),B=()=>f({url:"/pages/register/register"}),R=()=>{U.value&&U.value.getImageCaptcha()},S=async()=>{if(!V.username||!V.password)return m({title:"Please fill in all fields",icon:"none"});if(4!==V.captcha.length)return m({title:"Invalid Captcha",icon:"none"});k.value=!0;try{let a={password:V.password,captcha:V.captcha};const e=V.username;/^1\d{10}$/.test(e)?a.username="u"+e:/@/.test(e)?a.email=e:a.username=e;const s=await C.login(a);if(0!==s.errCode)throw new Error(s.errMsg||"Login failed");v.loginSuccess({...s,showToast:!0,autoBack:!1}),setTimeout((()=>{I.value?f({url:I.value}):p({url:"/pages/index/index"})}),800)}catch(a){console.error(a);let e=a.errMsg||a.message||"Login failed";"uni-id-captcha-required"===a.errCode||"uni-id-captcha-error"===a.errCode?(e="uni-id-captcha-required"===a.errCode?"请输入验证码":"验证码错误",R(),V.captcha=""):e.includes("User not exists")?e="账号不存在":e.includes("password")&&(e="密码错误",R(),V.captcha=""),m({title:e+"111",icon:"none"})}finally{k.value=!1}};return(a,e)=>{const s=h,p=r,f=_,m=w(l("uni-captcha"),b),x=g;return c(),t(p,{class:"auth-page"},{default:o((()=>[n(p,{class:"brand-side"},{default:o((()=>[n(p,{class:"brand-text"},{default:o((()=>[n(s,{class:"brand-logo"},{default:o((()=>[u("UNI-CLOUD")])),_:1}),n(s,{class:"brand-slogan"},{default:o((()=>[u("Build your future,"),i("br"),u("line by line.")])),_:1})])),_:1}),n(p,{class:"glass-decoration"})])),_:1}),n(p,{class:"form-side"},{default:o((()=>[n(p,{class:"form-container"},{default:o((()=>[n(p,{class:"back-home",onClick:j},{default:o((()=>[u("← Back to Home")])),_:1}),n(s,{class:"form-title"},{default:o((()=>[u("Welcome back")])),_:1}),n(s,{class:"form-sub"},{default:o((()=>[u("Please enter your details to sign in.")])),_:1}),n(s,{class:"form-sub"},{default:o((()=>[u("你的登录账号是 u+手机号，如u158xxxxxxxx")])),_:1}),n(p,{class:"input-group"},{default:o((()=>[n(s,{class:"label"},{default:o((()=>[u("Account")])),_:1}),n(f,{class:"input",type:"text",modelValue:V.username,"onUpdate:modelValue":e[0]||(e[0]=a=>V.username=a),placeholder:"Mobile / Username / Email","placeholder-class":"ph-style"},null,8,["modelValue"])])),_:1}),n(p,{class:"input-group"},{default:o((()=>[n(s,{class:"label"},{default:o((()=>[u("Password")])),_:1}),n(f,{class:"input",type:"password",modelValue:V.password,"onUpdate:modelValue":e[1]||(e[1]=a=>V.password=a),placeholder:"••••••••","placeholder-class":"ph-style"},null,8,["modelValue"])])),_:1}),n(p,{class:"input-group"},{default:o((()=>[n(s,{class:"label"},{default:o((()=>[u("Captcha")])),_:1}),n(p,{class:"captcha-box"},{default:o((()=>[n(p,{class:"captcha-img-wrapper",onClick:R},{default:o((()=>[n(m,{ref_key:"captchaRef",ref:U,scene:"login",modelValue:V.captcha,"onUpdate:modelValue":e[2]||(e[2]=a=>V.captcha=a),focus:!1},null,8,["modelValue"])])),_:1})])),_:1})])),_:1}),n(x,{class:"btn-submit",disabled:k.value,onClick:S},{default:o((()=>[u(d(k.value?"Signing in...":"Sign In"),1)])),_:1},8,["disabled"]),n(p,{class:"footer-link"},{default:o((()=>[n(s,null,{default:o((()=>[u("Don't have an account? ")])),_:1}),n(s,{class:"link",onClick:B},{default:o((()=>[u("Sign up for free")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})}}},[["__scopeId","data-v-befbe88a"]]);export{C as default};
