import{r as e,x as a,b as l,w as t,i as s,a as c,f as n,h as o,n as u,e as i,j as r,k as d,F as f,m,l as p,N as g,s as v,t as _,p as y,O as b,I as h,q as k,S as w,B as C,P as F,Q as P}from"./index-DwZjcXUC.js";import{P as D}from"./PcNavbar.6py-kavF.js";import{P as x}from"./PcFooter.oOdr90Xp.js";import{g as j}from"./cloud.3QmAUTVe.js";import{s as I}from"./store.DEtVyp6z.js";import{_ as E}from"./_plugin-vue_export-helper.BCo6x5W8.js";const L=E({__name:"index",setup(E){const L=j("feedback-co"),R=e("submit"),S=e(!1),U=e(!1),V=e([]),O=[{label:"ðŸ’¡ Suggestion",value:"suggestion"},{label:"ðŸ› Bug Report",value:"bug"},{label:"ðŸ“š Content Error",value:"content"},{label:"ðŸ’¬ Other",value:"other"}],T=a({type:"suggestion",content:"",contact:"",images:[]}),M=e([]),A=()=>{g({count:3-M.value.length,success:e=>{e.tempFilePaths.forEach((e=>{$(e)}))}})},N=e=>{let a=e.clipboardData;if(!a&&e.originalEvent&&(a=e.originalEvent.clipboardData),!a&&window.event&&(a=window.event.clipboardData),!a||!a.items)return;const l=a.items;for(let t=0;t<l.length;t++){const a=l[t];if(-1!==a.type.indexOf("image")){e.preventDefault&&e.preventDefault(),window.event&&window.event.preventDefault&&window.event.preventDefault();const l=a.getAsFile();if(l){const e=URL.createObjectURL(l);$(e,l)}}}},$=async(e,l=null)=>{if(M.value.length>=3)return v({title:"Max 3 images",icon:"none"});const t=a({localPath:e,cloudId:"",status:"uploading"});M.value.push(t);try{const a=`${I.userInfo.username}/feedback/${Date.now()}_${Math.random().toString(36).slice(2)}.jpg`,l=await _.uploadFile({filePath:e,cloudPath:a,fileType:"image"}),s=l.fileID||l.url;t.cloudId=s,t.status="success"}catch(s){console.error("ä¸Šä¼ å¤±è´¥:",s),t.status="error",v({title:"Upload failed",icon:"none"}),setTimeout((()=>{const e=M.value.indexOf(t);-1!==e&&M.value.splice(e,1)}),1e3)}},B=async()=>{if(!T.content.trim())return v({title:"å†…å®¹ä¸èƒ½ä¸ºç©º",icon:"none"});if(M.value.some((e=>"uploading"===e.status)))return v({title:"å›¾ç‰‡æ­£åœ¨ä¸Šä¼ ...",icon:"none"});S.value=!0,T.images=M.value.filter((e=>"success"===e.status)).map((e=>e.cloudId));try{0===(await L.submitFeedback(T)).errCode&&(v({title:"åé¦ˆæˆåŠŸ!",icon:"success"}),T.content="",T.contact="",T.images=[],M.value=[],setTimeout((()=>{R.value="list",H()}),1e3))}catch(e){console.error(e),v({title:"æäº¤å¤±è´¥",icon:"none"})}finally{S.value=!1}},H=async()=>{U.value=!0;try{const e=await L.getMyFeedbacks();if(0===e.errCode){const a=e.data;let l=[];if(a.forEach((e=>{e.images&&e.images.length&&(l=l.concat(e.images))})),l.length>0){const e=await _.getTempFileURL({fileList:l}),t={};e.fileList.forEach((e=>{t[e.fileID]=e.tempFileURL})),a.forEach((e=>{e.images&&e.images.length&&(e.images=e.images.map((e=>t[e]||e)))}))}V.value=a}}catch(e){console.error(e)}finally{U.value=!1}},W=e=>new Date(e).toLocaleDateString(),X=e=>({0:"Pending",1:"Processing",2:"Resolved",3:"Closed"}[e]||"Pending");return(e,a)=>{const g=y,v=s,_=b,j=P,I=h,E=k,L=w;return c(),l(v,{class:"feedback-page"},{default:t((()=>[n(D),n(v,{class:"container-xl"},{default:t((()=>[n(v,{class:"feedback-layout"},{default:t((()=>[n(v,{class:"layout-header"},{default:t((()=>[n(g,{class:"page-title"},{default:t((()=>[o("Help & Feedback")])),_:1}),n(g,{class:"page-sub"},{default:t((()=>[o("We value your voice. Help us improve.")])),_:1}),n(v,{class:"tab-switch"},{default:t((()=>[n(v,{class:u(["tab-item",{active:"submit"===R.value}]),onClick:a[0]||(a[0]=e=>R.value="submit")},{default:t((()=>[o(" âœï¸ Submit ")])),_:1},8,["class"]),n(v,{class:u(["tab-item",{active:"list"===R.value}]),onClick:a[1]||(a[1]=e=>{R.value="list",H()})},{default:t((()=>[o(" ðŸ—‚ï¸ My Records ")])),_:1},8,["class"]),n(v,{class:"tab-bg",style:i({transform:"submit"===R.value?"translateX(0)":"translateX(100%)"})},null,8,["style"])])),_:1})])),_:1}),n(v,{class:"layout-content"},{default:t((()=>["submit"===R.value?(c(),l(v,{key:0,class:"form-panel animate-fade"},{default:t((()=>[n(v,{class:"panel-title"},{default:t((()=>[o("What's on your mind?")])),_:1}),n(v,{class:"form-label"},{default:t((()=>[o("Feedback Type")])),_:1}),n(v,{class:"type-grid"},{default:t((()=>[(c(),r(f,null,d(O,(e=>n(v,{key:e.value,class:u(["type-chip",{active:T.type===e.value}]),onClick:a=>T.type=e.value},{default:t((()=>[o(p(e.label),1)])),_:2},1032,["class","onClick"]))),64))])),_:1}),n(v,{class:"form-label"},{default:t((()=>[o("Details & Attachments")])),_:1}),n(v,{class:"rich-input-wrapper"},{default:t((()=>[n(_,{class:"custom-textarea",modelValue:T.content,"onUpdate:modelValue":a[2]||(a[2]=e=>T.content=e),placeholder:"åœ¨æ­¤è¾“å…¥æ–‡å­—ï¼Œæˆ–ç›´æŽ¥ Ctrl+V ç²˜è´´æˆªå›¾...[Describe your issue... (You can paste screenshots here directly)]",maxlength:"500",onPaste:N},null,8,["modelValue"]),M.value.length>0?(c(),l(v,{key:0,class:"image-preview-list"},{default:t((()=>[(c(!0),r(f,null,d(M.value,((e,a)=>(c(),l(v,{class:"img-item",key:a},{default:t((()=>["uploading"===e.status?(c(),l(v,{key:0,class:"uploading-mask"},{default:t((()=>[n(v,{class:"spinner-sm"})])),_:1})):m("",!0),n(j,{src:e.localPath,mode:"aspectFill",class:"thumb",onClick:a=>{return l=e.localPath,void F({urls:[l]});var l}},null,8,["src","onClick"]),n(v,{class:"btn-remove",onClick:C((e=>(e=>{M.value.splice(e,1)})(a)),["stop"])},{default:t((()=>[o("âœ•")])),_:2},1032,["onClick"])])),_:2},1024)))),128))])),_:1})):m("",!0),n(v,{class:"input-toolbar"},{default:t((()=>[n(v,{class:"tool-btn",onClick:A},{default:t((()=>[n(g,{class:"icon"},{default:t((()=>[o("ðŸ“·")])),_:1}),n(g,null,{default:t((()=>[o("Add Image")])),_:1})])),_:1}),n(g,{class:"count"},{default:t((()=>[o(p(T.content.length)+"/500",1)])),_:1})])),_:1})])),_:1}),n(v,{class:"form-label"},{default:t((()=>[o("Contact (Optional)")])),_:1}),n(I,{class:"custom-input",modelValue:T.contact,"onUpdate:modelValue":a[3]||(a[3]=e=>T.contact=e),placeholder:"Email or phone number"},null,8,["modelValue"]),n(E,{class:"btn-submit",onClick:B,loading:S.value},{default:t((()=>[o(" Send Feedback ")])),_:1},8,["loading"])])),_:1})):(c(),l(v,{key:1,class:"list-panel animate-fade"},{default:t((()=>[U.value?(c(),l(v,{key:0,class:"loading-state"},{default:t((()=>[n(v,{class:"spinner"})])),_:1})):0===V.value.length?(c(),l(v,{key:1,class:"empty-state"},{default:t((()=>[n(g,{class:"empty-icon"},{default:t((()=>[o("ðŸƒ")])),_:1}),n(g,null,{default:t((()=>[o("No feedback yet.")])),_:1})])),_:1})):(c(),l(L,{key:2,"scroll-y":"",class:"list-scroll"},{default:t((()=>[(c(!0),r(f,null,d(V.value,(e=>(c(),l(v,{class:"record-card",key:e._id},{default:t((()=>[n(v,{class:"card-top"},{default:t((()=>{return[n(v,{class:"tags"},{default:t((()=>[n(g,{class:"tag-type"},{default:t((()=>{return[o(p((a=e.type,(null==(l=O.find((e=>e.value===a)))?void 0:l.label)||"Feedback")),1)];var a,l})),_:2},1024),n(g,{class:"date"},{default:t((()=>[o(p(W(e.create_date)),1)])),_:2},1024)])),_:2},1024),n(v,{class:u(["status-badge",(a=e.status,{0:"s-gray",1:"s-blue",2:"s-green",3:"s-red"}[a]||"s-gray")])},{default:t((()=>[o(p(X(e.status)),1)])),_:2},1032,["class"])];var a})),_:2},1024),n(g,{class:"user-content"},{default:t((()=>[o(p(e.content),1)])),_:2},1024),e.images&&e.images.length?(c(),l(v,{key:0,class:"record-images"},{default:t((()=>[(c(!0),r(f,null,d(e.images,((a,t)=>(c(),l(j,{key:t,src:a,mode:"aspectFill",class:"record-thumb",onClick:a=>{return l=e.images,void F({urls:l,current:t});var l}},null,8,["src","onClick"])))),128))])),_:2},1024)):m("",!0),e.reply_content?(c(),l(v,{key:1,class:"admin-reply"},{default:t((()=>[n(v,{class:"reply-header"},{default:t((()=>[n(g,{class:"icon"},{default:t((()=>[o("ðŸ‘©â€ðŸ’»")])),_:1}),n(g,{class:"name"},{default:t((()=>[o("Support Team")])),_:1}),n(g,{class:"time"},{default:t((()=>[o(p(W(e.reply_date)),1)])),_:2},1024)])),_:2},1024),n(g,{class:"reply-text"},{default:t((()=>[o(p(e.reply_content),1)])),_:2},1024)])),_:2},1024)):m("",!0)])),_:2},1024)))),128))])),_:1}))])),_:1}))])),_:1})])),_:1})])),_:1}),n(x)])),_:1})}}},[["__scopeId","data-v-07bd5566"]]);export{L as default};
