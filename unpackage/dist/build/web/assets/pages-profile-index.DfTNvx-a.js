import{r as a,E as e,x as s,o as l,H as t,b as c,w as r,i as u,a as i,f as o,h as d,R as n,l as f,m,N as _,J as p,t as v,K as g,s as h,v as y,p as b,Q as k,I as w,q as I}from"./index-DwZjcXUC.js";import{s as U,m as P}from"./store.DEtVyp6z.js";import{P as C}from"./PcNavbar.6py-kavF.js";import{P as F}from"./PcFooter.oOdr90Xp.js";import{F as j}from"./FeedbackFab.DPKefVxl.js";import{g as x}from"./cloud.3QmAUTVe.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";const N=L({__name:"index",setup(L){x("uni-id-co");const N=x("quiz-co"),S=a(!1),R=a({easy:0,medium:0,hard:0,total:0,accuracy:0}),V=e((()=>U.userInfo)),A=s({nickname:""}),D=e((()=>{const a=V.value.nickname||V.value.username||"U";return String(a).charAt(0).toUpperCase()}));l((()=>{U.hasLogin&&(A.nickname=V.value.nickname||"",(async()=>{try{const a=await N.getUserStatsToProfit();0===a.errCode&&(R.value=a.data)}catch(a){console.error(a)}})())}));const E=a("");t((()=>U.userInfo.avatar_file),(a=>{(async a=>{if(a)if(a.startsWith("http")||a.startsWith("blob"))E.value=a;else try{const e=await v.getTempFileURL({fileList:[a]});e.fileList&&e.fileList.length>0&&(E.value=e.fileList[0].tempFileURL)}catch(e){console.error("å¤´åƒé“¾æŽ¥è½¬æ¢å¤±è´¥",e)}else E.value=""})((null==a?void 0:a.url)||U.userInfo.avatar)}),{immediate:!0,deep:!0});const M=()=>{_({count:1,success:async a=>{const e=a.tempFilePaths[0];p({title:"Uploading..."});try{const a=await v.uploadFile({filePath:e,cloudPath:`${U.userInfo.username}/avatar/${U.userInfo._id}_${Date.now()}.jpg`});await P.updateUserInfo({avatar_file:{url:a.fileID}}),g(),h({title:"Avatar updated",icon:"success"})}catch(s){g(),console.error(s),h({title:"Upload failed",icon:"none"})}}})},$=async()=>{if(A.nickname.trim()){S.value=!0;try{await P.updateUserInfo({nickname:A.nickname})}catch(a){console.error(a)}finally{S.value=!1}}},q=()=>{y({url:"/uni_modules/uni-id-pages/pages/userinfo/change_pwd/change_pwd"})};return(a,e)=>{const s=u,l=b,t=k,_=w,p=I;return i(),c(s,{class:"profile-page"},{default:r((()=>[o(C),o(s,{class:"profile-bg"}),o(s,{class:"container-xl content-wrapper"},{default:r((()=>[o(s,{class:"page-header"},{default:r((()=>[o(l,{class:"title"},{default:r((()=>[d("Account Settings")])),_:1}),o(l,{class:"subtitle"},{default:r((()=>[d("Manage your profile details and security preferences.")])),_:1})])),_:1}),o(s,{class:"settings-grid"},{default:r((()=>[o(s,{class:"profile-sidebar"},{default:r((()=>[o(s,{class:"user-card"},{default:r((()=>[o(s,{class:"avatar-group",onClick:M},{default:r((()=>[n(U).userInfo.avatar_file.url?(i(),c(t,{key:0,src:E.value,class:"avatar-lg",mode:"aspectFill"},null,8,["src"])):(i(),c(s,{key:1,class:"avatar-placeholder"},{default:r((()=>[d(f(D.value),1)])),_:1})),o(s,{class:"avatar-overlay"},{default:r((()=>[o(l,{class:"icon-camera"},{default:r((()=>[d("ðŸ“·")])),_:1})])),_:1})])),_:1}),o(l,{class:"u-name"},{default:r((()=>[d(f(V.value.nickname||"User"),1)])),_:1}),o(l,{class:"u-role"},{default:r((()=>[d("Developer")])),_:1}),o(s,{class:"stat-row"},{default:r((()=>[o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n easy"},{default:r((()=>[d(f(R.value.easy),1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Easy")])),_:1})])),_:1}),o(s,{class:"s-sep"}),o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n medium"},{default:r((()=>[d(f(R.value.medium),1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Med")])),_:1})])),_:1}),o(s,{class:"s-sep"}),o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n hard"},{default:r((()=>[d(f(R.value.hard),1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Hard")])),_:1})])),_:1}),o(s,{class:"s-divider-vertical"}),o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n rate"},{default:r((()=>[d(f(R.value.accuracy)+"%",1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Rate")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(s,{class:"settings-main"},{default:r((()=>[o(s,{class:"setting-card"},{default:r((()=>[o(s,{class:"card-header"},{default:r((()=>[o(l,{class:"c-title"},{default:r((()=>[d("General Information")])),_:1})])),_:1}),o(s,{class:"card-body"},{default:r((()=>[o(s,{class:"form-item"},{default:r((()=>[o(l,{class:"label"},{default:r((()=>[d("Nickname")])),_:1}),o(_,{class:"input",modelValue:A.nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>A.nickname=a),placeholder:"Enter your nickname"},null,8,["modelValue"])])),_:1}),o(s,{class:"form-item"},{default:r((()=>[o(l,{class:"label"},{default:r((()=>[d("Mobile Number")])),_:1}),o(s,{class:"input disabled"},{default:r((()=>[o(l,null,{default:r((()=>[d(f(V.value.mobile||"Not bound"),1)])),_:1}),V.value.mobile_confirmed?(i(),c(l,{key:0,class:"tag-verified"},{default:r((()=>[d("Verified")])),_:1})):m("",!0)])),_:1}),o(l,{class:"helper-text"},{default:r((()=>[d("Contact support to change your mobile number.")])),_:1})])),_:1})])),_:1}),o(s,{class:"card-footer"},{default:r((()=>[o(p,{class:"btn-save",onClick:$,loading:S.value},{default:r((()=>[d("Save Changes")])),_:1},8,["loading"])])),_:1})])),_:1}),o(s,{class:"setting-card"},{default:r((()=>[o(s,{class:"card-header"},{default:r((()=>[o(l,{class:"c-title"},{default:r((()=>[d("Security")])),_:1})])),_:1}),o(s,{class:"card-body"},{default:r((()=>[o(s,{class:"security-row"},{default:r((()=>[o(s,{class:"sec-info"},{default:r((()=>[o(l,{class:"sec-label"},{default:r((()=>[d("Password")])),_:1}),o(l,{class:"sec-desc"},{default:r((()=>[d("Last changed 3 months ago")])),_:1})])),_:1}),o(p,{class:"btn-outline",onClick:q},{default:r((()=>[d("Change Password")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(F),o(j)])),_:1})}}},[["__scopeId","data-v-37352b35"]]);export{N as default};
