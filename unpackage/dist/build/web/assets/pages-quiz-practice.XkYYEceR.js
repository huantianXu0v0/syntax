import{r as a,D as e,H as l,b as s,w as t,i as u,a as c,h as n,j as r,u as o,e as d,A as v,G as i,n as f,f as _,l as p,F as g,s as y,J as h,K as m,E as k,p as b,S as w,q as C,L as x}from"./index-izamIF4t.js";import{o as I,a as q}from"./uni-app.es.CDCFQLwe.js";import{Q as j,a as A}from"./QuizCodeGap.DUNUcGnn.js";import{g as S}from"./cloud.DKwZ7jLR.js";import{_ as Q}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=Q({__name:"practice",setup(Q){const V=S("quiz-co"),z=a(!0),E=a([]),L=a(0),P=a([]),T=a([]),$=a({}),B=a(null),D=a(!1),F=a(!1),G=a(0),H=a(!1);let M=null;const N=e((()=>E.value[L.value])),U=e((()=>P.value[L.value]||[])),Y=e((()=>!0===T.value[L.value])),J=e((()=>(L.value+1)/E.value.length*100)),K=e((()=>{var a;return(null==(a=B.value)?void 0:a.is_correct)||!1})),O=e((()=>Object.values($.value).filter((a=>a&&a.is_correct)).length)),W=e((()=>T.value.filter((a=>a)).length)),R=e((()=>E.value.length-W.value));l(L,(a=>{T.value[a]&&$.value[a]?B.value=$.value[a]:B.value=null}));const X=e((()=>Y.value?L.value===E.value.length-1?"Finish":"Next Question":"Check Answer")),Z=e((()=>Y.value?K.value?"btn-success":"btn-retry":""));I((a=>{a.categoryId&&aa(a.categoryId),a.startIndex&&(L.value=parseInt(a.startIndex))}));const aa=async a=>{try{const e=await V.getQuestionsByChapter(a);0===e.errCode&&(E.value=e.data,P.value=new Array(e.data.length).fill().map((()=>[])),T.value=new Array(e.data.length).fill(!1))}finally{z.value=!1}},ea=()=>{L.value<E.value.length-1&&L.value++},la=async()=>{if(Y.value)L.value<E.value.length-1?L.value++:sa();else{if(0===U.value.length)return y({title:"Please enter answer",icon:"none"});h({title:"Checking..."});try{const a=await V.checkAnswer(N.value._id,U.value,G.value,"practice");0===a.errCode?(B.value=a.data,T.value[L.value]=!0,$.value[L.value]=a.data,H.value||ca()):y({title:"Check failed",icon:"none"})}finally{m()}}},sa=()=>{R.value>0?(y({title:`You have ${R.value} unfinished questions`,icon:"none"}),D.value=!0):(H.value&&ca(),F.value=!0)},ta=()=>D.value=!D.value,ua=a=>{const e=[];if(a===L.value&&e.push("active-border"),T.value[a]){const l=$.value[a],s=l&&!0===l.is_correct;e.push(s?"correct":"wrong")}else e.push("todo");return e.join(" ")},ca=()=>{H.value?(clearInterval(M),H.value=!1):(H.value=!0,M=setInterval((()=>{G.value++}),1e3))},na=()=>{x(),M&&clearInterval(M),H.value=!1,G.value=0},ra=()=>{L.value>0&&(L.value--,B.value=null)},oa=()=>k(),da=()=>{L.value=0,P.value=P.value.map((()=>[])),T.value=T.value.map((()=>!1)),$.value={},B.value=null,G.value=0,F.value=!1,D.value=!1},va=a=>`${Math.floor(a/60).toString().padStart(2,"0")}:${(a%60).toString().padStart(2,"0")}`;return q((()=>{M&&clearInterval(M)})),(a,e)=>{const l=u,y=b,h=w,m=C;return c(),s(l,{class:"quiz-workspace"},{default:t((()=>[n(l,{class:"quiz-header"},{default:t((()=>[n(l,{class:"header-left",onClick:oa},{default:t((()=>[n(l,{class:"btn-close"},{default:t((()=>[r("Exit")])),_:1})])),_:1}),n(l,{class:"header-center"},{default:t((()=>[n(y,{class:"progress-text"},{default:t((()=>[r("Question "+o(L.value+1)+" / "+o(E.value.length),1)])),_:1}),n(l,{class:"progress-track"},{default:t((()=>[n(l,{class:"progress-fill",style:d({width:J.value+"%"})},null,8,["style"])])),_:1})])),_:1}),n(l,{class:"header-right"},{default:t((()=>[n(l,{class:"list-toggle",onClick:ta},{default:t((()=>[n(y,{class:"icon-list"},{default:t((()=>[r("â˜°")])),_:1}),n(y,{class:"list-text"},{default:t((()=>[r(o(W.value)+"/"+o(E.value.length),1)])),_:1})])),_:1}),n(l,{class:"timer-wrapper"},{default:t((()=>[G.value>0?(c(),s(l,{key:0,class:"reset-btn",onClick:v(na,["stop"])},{default:t((()=>[r("â†º")])),_:1})):i("",!0),n(l,{class:f(["timer-badge",{"is-running":H.value}]),onClick:ca},{default:t((()=>[n(y,{class:"timer-icon"},{default:t((()=>[r(o(H.value?"â¸":"â–¶ï¸"),1)])),_:1}),n(y,null,{default:t((()=>[r(o(va(G.value)),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),z.value?(c(),s(l,{key:0,class:"loading-container"},{default:t((()=>[n(l,{class:"spinner"}),n(y,null,{default:t((()=>[r("Preparing your workspace...")])),_:1})])),_:1})):N.value?(c(),s(l,{key:1,class:"quiz-body"},{default:t((()=>[n(l,{class:"panel-context"},{default:t((()=>[n(h,{"scroll-y":"",class:"scroll-inner"},{default:t((()=>[n(l,{class:"context-content"},{default:t((()=>[n(l,{class:"tags-row"},{default:t((()=>[n(l,{class:f(["tag difficulty","lv-"+N.value.difficulty])},{default:t((()=>{return[r(o((a=N.value.difficulty,{1:"Easy",2:"Medium",3:"Hard"}[a]||"Easy")),1)];var a})),_:1},8,["class"]),n(l,{class:"tag type"},{default:t((()=>[r(o("code_gap"===N.value.type?"Code":"Choice"),1)])),_:1})])),_:1}),n(y,{class:"q-title"},{default:t((()=>[r(o(N.value.title),1)])),_:1})])),_:1})])),_:1})])),_:1}),n(l,{class:"panel-interaction"},{default:t((()=>[n(h,{"scroll-y":"",class:"scroll-inner"},{default:t((()=>[n(l,{class:"interaction-content"},{default:t((()=>{var a,u;return["choice"===N.value.type?(c(),s(j,{key:0,options:N.value.content.options,modelValue:P.value[L.value],"onUpdate:modelValue":e[0]||(e[0]=a=>P.value[L.value]=a),"show-result":Y.value,"correct-answer":(null==(a=B.value)?void 0:a.correct_val)||[]},null,8,["options","modelValue","show-result","correct-answer"])):"code_gap"===N.value.type?(c(),s(A,{key:1,code:N.value.content.code_snippet,lang:N.value.content.language,"gap-mode":N.value.content.gap_mode,"gap-options":N.value.content.gap_options,modelValue:P.value[L.value],"onUpdate:modelValue":e[1]||(e[1]=a=>P.value[L.value]=a),"show-result":Y.value,"correct-answer":(null==(u=B.value)?void 0:u.correct_val)||[]},null,8,["code","lang","gap-mode","gap-options","modelValue","show-result","correct-answer"])):i("",!0),Y.value&&B.value?(c(),s(l,{key:2,class:f(["feedback-card",K.value?"success":"error"])},{default:t((()=>[n(l,{class:"fb-header"},{default:t((()=>[n(y,{class:"fb-icon"},{default:t((()=>[r(o(K.value?"ðŸŽ‰":"ðŸ¤”"),1)])),_:1}),n(y,{class:"fb-title"},{default:t((()=>[r(o(K.value?"Correct!":"Incorrect"),1)])),_:1})])),_:1}),n(y,{class:"fb-desc"},{default:t((()=>[r(o(B.value.analysis||"No analysis provided."),1)])),_:1})])),_:1},8,["class"])):i("",!0)]})),_:1})])),_:1})])),_:1})])),_:1})):i("",!0),n(l,{class:"action-bar"},{default:t((()=>[n(l,{class:"bar-inner"},{default:t((()=>[n(l,{class:"btn-group"},{default:t((()=>[n(m,{class:"btn-secondary",onClick:ra,disabled:0===L.value},{default:t((()=>[r("Prev")])),_:1},8,["disabled"]),!Y.value&&L.value<E.value.length-1?(c(),s(m,{key:0,class:"btn-secondary",onClick:ea},{default:t((()=>[r(" Skip ")])),_:1})):i("",!0),n(m,{class:f(["btn-primary",Z.value]),onClick:la},{default:t((()=>[r(o(X.value),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),D.value?(c(),s(l,{key:2,class:"drawer-overlay",onClick:ta},{default:t((()=>[n(l,{class:"drawer-panel",onClick:e[2]||(e[2]=v((()=>{}),["stop"]))},{default:t((()=>[n(l,{class:"drawer-header"},{default:t((()=>[n(y,{class:"dh-title"},{default:t((()=>[r("Question List")])),_:1}),n(l,{class:"dh-stats"},{default:t((()=>[n(y,{class:"ds-item"},{default:t((()=>[n(y,{class:"dot green"}),r(" Correct")])),_:1}),n(y,{class:"ds-item"},{default:t((()=>[n(y,{class:"dot red"}),r(" Wrong")])),_:1}),n(y,{class:"ds-item"},{default:t((()=>[n(y,{class:"dot gray"}),r(" Todo")])),_:1})])),_:1})])),_:1}),n(h,{"scroll-y":"",class:"drawer-body"},{default:t((()=>[n(l,{class:"q-grid"},{default:t((()=>[(c(!0),_(g,null,p(E.value,((a,e)=>(c(),s(l,{class:f(["q-cell",ua(e)]),key:a._id,onClick:a=>(a=>{L.value=a,D.value=!1})(e)},{default:t((()=>[r(o(e+1)+" ",1),e===L.value?(c(),s(l,{key:0,class:"current-indicator"})):i("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),R.value>0?(c(),s(l,{key:0,class:"drawer-footer"},{default:t((()=>[n(y,{class:"warn-text"},{default:t((()=>[r("âš ï¸ You have "+o(R.value)+" unanswered questions.",1)])),_:1})])),_:1})):i("",!0)])),_:1})])),_:1})):i("",!0),F.value?(c(),s(l,{key:3,class:"result-modal"},{default:t((()=>[n(l,{class:"modal-backdrop"}),n(l,{class:"modal-content"},{default:t((()=>[n(l,{class:"modal-icon"},{default:t((()=>[r("ðŸ†")])),_:1}),n(y,{class:"modal-title"},{default:t((()=>[r("Session Complete!")])),_:1}),n(l,{class:"stats-grid"},{default:t((()=>[n(l,{class:"stat-box highlight"},{default:t((()=>[n(y,{class:"val"},{default:t((()=>[r(o(O.value)+" / "+o(E.value.length),1)])),_:1}),n(y,{class:"label"},{default:t((()=>[r("Correct Answers")])),_:1})])),_:1}),n(l,{class:"stat-box"},{default:t((()=>[n(y,{class:"val"},{default:t((()=>[r(o(va(G.value)),1)])),_:1}),n(y,{class:"label"},{default:t((()=>[r("Time Spent")])),_:1})])),_:1})])),_:1}),n(l,{class:"modal-actions"},{default:t((()=>[n(m,{class:"btn-outline",onClick:da},{default:t((()=>[r("Try Again")])),_:1}),n(m,{class:"btn-fill",onClick:oa},{default:t((()=>[r("Back to Library")])),_:1})])),_:1})])),_:1})])),_:1})):i("",!0)])),_:1})}}},[["__scopeId","data-v-460d6e55"]]);export{V as default};
