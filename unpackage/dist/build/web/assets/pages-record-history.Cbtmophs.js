import{r as e,D as a,o as l,f as s,h as t,w as o,F as r,i as c,a as u,j as n,u as i,b as d,l as _,n as f,G as p,A as v,m,p as g,q as y,S as h,e as w,s as k}from"./index-izamIF4t.js";import{P as q}from"./PcNavbar.BqnQAoPn.js";import{P as C}from"./PcFooter.BYFzZ3uH.js";import{F as b}from"./FeedbackFab.9VM6uxy5.js";import{g as j}from"./cloud.DKwZ7jLR.js";import{Q as x,a as D}from"./QuizCodeGap.DUNUcGnn.js";import{_ as S}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./store.-x3VDdyk.js";const F=S({__name:"history",setup(S){const F=j("quiz-co"),L=e([]),P=e(0),A=e(!0),T=e(1),U=e(!0),V=e(!1),G=e(!1),H=e(null),M=async(e=!1)=>{e&&(A.value=!0);try{const a=await F.getUserHistory(T.value,10);0===a.errCode&&(e?L.value.push(...a.data.list):L.value=a.data.list,P.value=a.data.total,U.value=a.data.has_more)}catch(a){console.error(a)}finally{A.value=!1}},N=()=>{U.value&&(T.value++,M(!0))},Q=a((()=>{if(0===L.value.length)return 0;return(L.value.filter((e=>e.is_correct)).length/L.value.length*100).toFixed(0)})),R=()=>m({url:"/pages/study/index"}),$=()=>{V.value=!1},z=(e,a)=>{if(!e)return"-";const l=new Date(e);if("date"===a){const e=new Date;return l.toDateString()===e.toDateString()?"Today":l.toLocaleDateString("en-US",{month:"short",day:"numeric"})}return l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})};return l((()=>{M()})),(e,a)=>{const l=g,m=c,j=y,S=h;return u(),s(r,null,[t(m,{class:"history-page"},{default:o((()=>[t(q),t(m,{class:"container-xl content-wrapper"},{default:o((()=>[t(m,{class:"page-header"},{default:o((()=>[t(m,{class:"title-group"},{default:o((()=>[t(l,{class:"main-title"},{default:o((()=>[n("Learning History")])),_:1}),t(l,{class:"sub-title"},{default:o((()=>[n("Track your progress and review past challenges.")])),_:1})])),_:1}),t(m,{class:"stats-mini"},{default:o((()=>[t(m,{class:"stat-pill"},{default:o((()=>[t(l,{class:"label"},{default:o((()=>[n("Total")])),_:1}),t(l,{class:"val"},{default:o((()=>[n(i(P.value),1)])),_:1})])),_:1}),t(m,{class:"stat-pill"},{default:o((()=>[t(l,{class:"label"},{default:o((()=>[n("Accuracy")])),_:1}),t(l,{class:"val highlight"},{default:o((()=>[n(i(Q.value)+"%",1)])),_:1})])),_:1})])),_:1})])),_:1}),L.value.length>0?(u(),d(m,{key:0,class:"timeline-container"},{default:o((()=>[t(m,{class:"timeline-line"}),(u(!0),s(r,null,_(L.value,((e,a)=>(u(),d(m,{class:"timeline-item animate-up",key:e._id,style:w({animationDelay:50*a+"ms"})},{default:o((()=>[t(m,{class:"time-node"},{default:o((()=>[t(l,{class:"time-date"},{default:o((()=>[n(i(z(e.create_date,"date")),1)])),_:2},1024),t(l,{class:"time-clock"},{default:o((()=>[n(i(z(e.create_date,"time")),1)])),_:2},1024)])),_:2},1024),t(m,{class:"status-dot-wrapper"},{default:o((()=>[t(m,{class:f(["dot",e.is_correct?"success":"error"])},{default:o((()=>[t(l,{class:"dot-icon"},{default:o((()=>[n(i(e.is_correct?"‚úì":"‚úï"),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),t(m,{class:"record-card",onClick:a=>(async e=>{V.value=!0,G.value=!0,H.value=null;try{const a=await F.getRecordDetail(e._id);0===a.errCode?H.value=a.data:(k({title:"Fetch failed",icon:"none"}),V.value=!1)}catch(a){console.error(a)}finally{G.value=!1}})(e)},{default:o((()=>[t(m,{class:"card-header"},{default:o((()=>[t(m,{class:"tags"},{default:o((()=>[t(l,{class:"tag category"},{default:o((()=>[n(i(e.category_name||"General"),1)])),_:2},1024),t(l,{class:"tag type"},{default:o((()=>[n(i("code_gap"===e.question_type?"Code":"Choice"),1)])),_:2},1024)])),_:2},1024),t(l,{class:"duration"},{default:o((()=>{return[n("‚è± "+i((a=e.duration,a?a<60?`${a}s`:`${Math.floor(a/60)}m ${a%60}s`:"0s")),1)];var a})),_:2},1024)])),_:2},1024),t(l,{class:"q-title"},{default:o((()=>[n(i(e.question_title||"Untitled Question"),1)])),_:2},1024),t(m,{class:"card-footer"},{default:o((()=>[t(l,{class:"score"},{default:o((()=>[n("Score: "),t(l,{class:f(e.is_correct?"s-high":"s-low")},{default:o((()=>[n(i(e.score),1)])),_:2},1032,["class"])])),_:2},1024),t(l,{class:"review-link"},{default:o((()=>[n("Review Answer ‚Üí")])),_:1})])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["style"])))),128)),t(m,{class:"load-more-wrapper"},{default:o((()=>[U.value?(u(),d(j,{key:0,class:"btn-load-more",loading:A.value,onClick:N},{default:o((()=>[n(i(A.value?"Loading...":"Load More History"),1)])),_:1},8,["loading"])):(u(),d(l,{key:1,class:"no-more-text"},{default:o((()=>[n("End of the journey.")])),_:1}))])),_:1})])),_:1})):A.value?(u(),d(m,{key:2,class:"loading-state"},{default:o((()=>[t(m,{class:"spinner"})])),_:1})):(u(),d(m,{key:1,class:"empty-state"},{default:o((()=>[t(m,{class:"empty-icon"},{default:o((()=>[n("üìÇ")])),_:1}),t(l,{class:"empty-text"},{default:o((()=>[n("No records found yet.")])),_:1}),t(j,{class:"btn-go",onClick:R},{default:o((()=>[n("Start Practicing")])),_:1})])),_:1}))])),_:1}),t(C),V.value?(u(),d(m,{key:0,class:"review-modal",onClick:v($,["self"])},{default:o((()=>[t(m,{class:"modal-body"},{default:o((()=>[G.value?(u(),d(m,{key:0,class:"modal-loading"},{default:o((()=>[t(m,{class:"spinner"})])),_:1})):H.value?(u(),s(r,{key:1},[t(m,{class:"m-header"},{default:o((()=>[t(m,{class:"m-title-group"},{default:o((()=>[t(l,{class:f(["tag",H.value.record.is_correct?"success":"error"])},{default:o((()=>[n(i(H.value.record.is_correct?"Correct":"Mistake"),1)])),_:1},8,["class"]),t(l,{class:"title"},{default:o((()=>[n("Review Challenge")])),_:1})])),_:1}),t(m,{class:"btn-close",onClick:$},{default:o((()=>[n("‚úï")])),_:1})])),_:1}),t(S,{"scroll-y":"",class:"m-scroll-content"},{default:o((()=>[t(m,{class:"m-content"},{default:o((()=>[t(l,{class:"q-title"},{default:o((()=>[n(i(H.value.question.title),1)])),_:1}),t(m,{class:"component-wrapper"},{default:o((()=>["choice"===H.value.question.type?(u(),d(x,{key:0,options:H.value.question.content.options,modelValue:H.value.record.user_answer,"show-result":!0,"correct-answer":H.value.question.answer.correct_val},null,8,["options","modelValue","correct-answer"])):(u(),d(D,{key:1,code:H.value.question.content.code_snippet,lang:H.value.question.content.language,"gap-mode":H.value.question.content.gap_mode,"gap-options":H.value.question.content.gap_options,modelValue:H.value.record.user_answer,"show-result":!0,"correct-answer":H.value.question.answer.correct_val},null,8,["code","lang","gap-mode","gap-options","modelValue","correct-answer"]))])),_:1}),t(m,{class:"analysis-card"},{default:o((()=>[t(m,{class:"an-header"},{default:o((()=>[t(l,{class:"icon"},{default:o((()=>[n("üí°")])),_:1}),t(l,{class:"label"},{default:o((()=>[n("Analysis")])),_:1})])),_:1}),t(l,{class:"an-text"},{default:o((()=>[n(i(H.value.question.answer.analysis||"No analysis provided."),1)])),_:1})])),_:1})])),_:1})])),_:1})],64)):p("",!0)])),_:1})])),_:1})):p("",!0)])),_:1}),t(b)],64)}}},[["__scopeId","data-v-4ee37608"]]);export{F as default};
