import{r as a,D as e,v as s,o as l,H as t,b as c,w as r,i as u,a as i,h as o,j as d,R as n,u as f,G as m,N as _,J as p,t as v,K as g,s as h,m as y,p as b,Q as k,I as w,q as I}from"./index-izamIF4t.js";import{s as U,m as P}from"./store.-x3VDdyk.js";import{P as j}from"./PcNavbar.BqnQAoPn.js";import{P as C}from"./PcFooter.BYFzZ3uH.js";import{F}from"./FeedbackFab.9VM6uxy5.js";import{g as L}from"./cloud.DKwZ7jLR.js";import{_ as x}from"./_plugin-vue_export-helper.BCo6x5W8.js";const N=x({__name:"index",setup(x){L("uni-id-co");const N=L("quiz-co"),S=a(!1),D=a({easy:0,medium:0,hard:0,total:0,accuracy:0}),R=e((()=>U.userInfo)),V=s({nickname:""}),A=e((()=>{const a=R.value.nickname||R.value.username||"U";return String(a).charAt(0).toUpperCase()}));l((()=>{U.hasLogin&&(V.nickname=R.value.nickname||"",(async()=>{try{const a=await N.getUserStatsToProfit();0===a.errCode&&(D.value=a.data)}catch(a){console.error(a)}})())}));const M=a("");t((()=>U.userInfo.avatar_file),(a=>{(async a=>{if(a)if(a.startsWith("http")||a.startsWith("blob"))M.value=a;else try{const e=await v.getTempFileURL({fileList:[a]});e.fileList&&e.fileList.length>0&&(M.value=e.fileList[0].tempFileURL)}catch(e){console.error("å¤´åƒé“¾æŽ¥è½¬æ¢å¤±è´¥",e)}else M.value=""})((null==a?void 0:a.url)||U.userInfo.avatar)}),{immediate:!0,deep:!0});const $=()=>{_({count:1,success:async a=>{const e=a.tempFilePaths[0];p({title:"Uploading..."});try{const a=await v.uploadFile({filePath:e,cloudPath:`${U.userInfo.username}/avatar/${U.userInfo._id}_${Date.now()}.jpg`});await P.updateUserInfo({avatar_file:{url:a.fileID}}),g(),h({title:"Avatar updated",icon:"success"})}catch(s){g(),console.error(s),h({title:"Upload failed",icon:"none"})}}})},q=async()=>{if(V.nickname.trim()){S.value=!0;try{await P.updateUserInfo({nickname:V.nickname})}catch(a){console.error(a)}finally{S.value=!1}}},E=()=>{y({url:"/uni_modules/uni-id-pages/pages/userinfo/change_pwd/change_pwd"})};return(a,e)=>{const s=u,l=b,t=k,_=w,p=I;return i(),c(s,{class:"profile-page"},{default:r((()=>[o(j),o(s,{class:"profile-bg"}),o(s,{class:"container-xl content-wrapper"},{default:r((()=>[o(s,{class:"page-header"},{default:r((()=>[o(l,{class:"title"},{default:r((()=>[d("Account Settings")])),_:1}),o(l,{class:"subtitle"},{default:r((()=>[d("Manage your profile details and security preferences.")])),_:1})])),_:1}),o(s,{class:"settings-grid"},{default:r((()=>[o(s,{class:"profile-sidebar"},{default:r((()=>[o(s,{class:"user-card"},{default:r((()=>[o(s,{class:"avatar-group",onClick:$},{default:r((()=>[n(U).userInfo.avatar_file.url?(i(),c(t,{key:0,src:M.value,class:"avatar-lg",mode:"aspectFill"},null,8,["src"])):(i(),c(s,{key:1,class:"avatar-placeholder"},{default:r((()=>[d(f(A.value),1)])),_:1})),o(s,{class:"avatar-overlay"},{default:r((()=>[o(l,{class:"icon-camera"},{default:r((()=>[d("ðŸ“·")])),_:1})])),_:1})])),_:1}),o(l,{class:"u-name"},{default:r((()=>[d(f(R.value.nickname||"User"),1)])),_:1}),o(l,{class:"u-role"},{default:r((()=>[d("Developer")])),_:1}),o(s,{class:"stat-row"},{default:r((()=>[o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n easy"},{default:r((()=>[d(f(D.value.easy),1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Easy")])),_:1})])),_:1}),o(s,{class:"s-sep"}),o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n medium"},{default:r((()=>[d(f(D.value.medium),1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Med")])),_:1})])),_:1}),o(s,{class:"s-sep"}),o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n hard"},{default:r((()=>[d(f(D.value.hard),1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Hard")])),_:1})])),_:1}),o(s,{class:"s-divider-vertical"}),o(s,{class:"s-item"},{default:r((()=>[o(l,{class:"n rate"},{default:r((()=>[d(f(D.value.accuracy)+"%",1)])),_:1}),o(l,{class:"l"},{default:r((()=>[d("Rate")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(s,{class:"settings-main"},{default:r((()=>[o(s,{class:"setting-card"},{default:r((()=>[o(s,{class:"card-header"},{default:r((()=>[o(l,{class:"c-title"},{default:r((()=>[d("General Information")])),_:1})])),_:1}),o(s,{class:"card-body"},{default:r((()=>[o(s,{class:"form-item"},{default:r((()=>[o(l,{class:"label"},{default:r((()=>[d("Nickname")])),_:1}),o(_,{class:"input",modelValue:V.nickname,"onUpdate:modelValue":e[0]||(e[0]=a=>V.nickname=a),placeholder:"Enter your nickname"},null,8,["modelValue"])])),_:1}),o(s,{class:"form-item"},{default:r((()=>[o(l,{class:"label"},{default:r((()=>[d("Mobile Number")])),_:1}),o(s,{class:"input disabled"},{default:r((()=>[o(l,null,{default:r((()=>[d(f(R.value.mobile||"Not bound"),1)])),_:1}),R.value.mobile_confirmed?(i(),c(l,{key:0,class:"tag-verified"},{default:r((()=>[d("Verified")])),_:1})):m("",!0)])),_:1}),o(l,{class:"helper-text"},{default:r((()=>[d("Contact support to change your mobile number.")])),_:1})])),_:1})])),_:1}),o(s,{class:"card-footer"},{default:r((()=>[o(p,{class:"btn-save",onClick:q,loading:S.value},{default:r((()=>[d("Save Changes")])),_:1},8,["loading"])])),_:1})])),_:1}),o(s,{class:"setting-card"},{default:r((()=>[o(s,{class:"card-header"},{default:r((()=>[o(l,{class:"c-title"},{default:r((()=>[d("Security")])),_:1})])),_:1}),o(s,{class:"card-body"},{default:r((()=>[o(s,{class:"security-row"},{default:r((()=>[o(s,{class:"sec-info"},{default:r((()=>[o(l,{class:"sec-label"},{default:r((()=>[d("Password")])),_:1}),o(l,{class:"sec-desc"},{default:r((()=>[d("Last changed 3 months ago")])),_:1})])),_:1}),o(p,{class:"btn-outline",onClick:E},{default:r((()=>[d("Change Password")])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1})])),_:1}),o(C),o(F)])),_:1})}}},[["__scopeId","data-v-37352b35"]]);export{N as default};
