import{r as e,E as a,o as l,j as s,f as t,w as o,F as r,i as c,a as u,h as n,l as i,b as d,k as _,n as f,m as p,B as v,v as m,p as g,q as y,S as h,e as w,s as k}from"./index-DwZjcXUC.js";import{P as q}from"./PcNavbar.6py-kavF.js";import{P as C}from"./PcFooter.oOdr90Xp.js";import{F as b}from"./FeedbackFab.DPKefVxl.js";import{g as j}from"./cloud.3QmAUTVe.js";import{Q as x,a as S}from"./QuizCodeGap.BJp0ikS-.js";import{_ as D}from"./_plugin-vue_export-helper.BCo6x5W8.js";import"./store.DEtVyp6z.js";const F=D({__name:"history",setup(D){const F=j("quiz-co"),L=e([]),P=e(0),T=e(!0),U=e(1),V=e(!0),A=e(!1),H=e(!1),M=e(null),N=async(e=!1)=>{e&&(T.value=!0);try{const a=await F.getUserHistory(U.value,10);0===a.errCode&&(e?L.value.push(...a.data.list):L.value=a.data.list,P.value=a.data.total,V.value=a.data.has_more)}catch(a){console.error(a)}finally{T.value=!1}},Q=()=>{V.value&&(U.value++,N(!0))},R=a((()=>{if(0===L.value.length)return 0;return(L.value.filter((e=>e.is_correct)).length/L.value.length*100).toFixed(0)})),$=()=>m({url:"/pages/study/index"}),z=()=>{A.value=!1},E=(e,a)=>{if(!e)return"-";const l=new Date(e);if("date"===a){const e=new Date;return l.toDateString()===e.toDateString()?"Today":l.toLocaleDateString("en-US",{month:"short",day:"numeric"})}return l.toLocaleTimeString("en-US",{hour:"2-digit",minute:"2-digit",hour12:!1})};return l((()=>{N()})),(e,a)=>{const l=g,m=c,j=y,D=h;return u(),s(r,null,[t(m,{class:"history-page"},{default:o((()=>[t(q),t(m,{class:"container-xl content-wrapper"},{default:o((()=>[t(m,{class:"page-header"},{default:o((()=>[t(m,{class:"title-group"},{default:o((()=>[t(l,{class:"main-title"},{default:o((()=>[n("Learning History")])),_:1}),t(l,{class:"sub-title"},{default:o((()=>[n("Track your progress and review past challenges.")])),_:1})])),_:1}),t(m,{class:"stats-mini"},{default:o((()=>[t(m,{class:"stat-pill"},{default:o((()=>[t(l,{class:"label"},{default:o((()=>[n("Total")])),_:1}),t(l,{class:"val"},{default:o((()=>[n(i(P.value),1)])),_:1})])),_:1}),t(m,{class:"stat-pill"},{default:o((()=>[t(l,{class:"label"},{default:o((()=>[n("Accuracy")])),_:1}),t(l,{class:"val highlight"},{default:o((()=>[n(i(R.value)+"%",1)])),_:1})])),_:1})])),_:1})])),_:1}),L.value.length>0?(u(),d(m,{key:0,class:"timeline-container"},{default:o((()=>[t(m,{class:"timeline-line"}),(u(!0),s(r,null,_(L.value,((e,a)=>(u(),d(m,{class:"timeline-item animate-up",key:e._id,style:w({animationDelay:50*a+"ms"})},{default:o((()=>[t(m,{class:"time-node"},{default:o((()=>[t(l,{class:"time-date"},{default:o((()=>[n(i(E(e.create_date,"date")),1)])),_:2},1024),t(l,{class:"time-clock"},{default:o((()=>[n(i(E(e.create_date,"time")),1)])),_:2},1024)])),_:2},1024),t(m,{class:"status-dot-wrapper"},{default:o((()=>[t(m,{class:f(["dot",e.is_correct?"success":"error"])},{default:o((()=>[t(l,{class:"dot-icon"},{default:o((()=>[n(i(e.is_correct?"‚úì":"‚úï"),1)])),_:2},1024)])),_:2},1032,["class"])])),_:2},1024),t(m,{class:"record-card",onClick:a=>(async e=>{A.value=!0,H.value=!0,M.value=null;try{const a=await F.getRecordDetail(e._id);0===a.errCode?M.value=a.data:(k({title:"Fetch failed",icon:"none"}),A.value=!1)}catch(a){console.error(a)}finally{H.value=!1}})(e)},{default:o((()=>[t(m,{class:"card-header"},{default:o((()=>[t(m,{class:"tags"},{default:o((()=>[t(l,{class:"tag category"},{default:o((()=>[n(i(e.category_name||"General"),1)])),_:2},1024),t(l,{class:"tag type"},{default:o((()=>[n(i("code_gap"===e.question_type?"Code":"Choice"),1)])),_:2},1024)])),_:2},1024),t(l,{class:"duration"},{default:o((()=>{return[n("‚è± "+i((a=e.duration,a?a<60?`${a}s`:`${Math.floor(a/60)}m ${a%60}s`:"0s")),1)];var a})),_:2},1024)])),_:2},1024),t(l,{class:"q-title"},{default:o((()=>[n(i(e.question_title||"Untitled Question"),1)])),_:2},1024),t(m,{class:"card-footer"},{default:o((()=>[t(l,{class:"score"},{default:o((()=>[n("Score: "),t(l,{class:f(e.is_correct?"s-high":"s-low")},{default:o((()=>[n(i(e.score),1)])),_:2},1032,["class"])])),_:2},1024),t(l,{class:"review-link"},{default:o((()=>[n("Review Answer ‚Üí")])),_:1})])),_:2},1024)])),_:2},1032,["onClick"])])),_:2},1032,["style"])))),128)),t(m,{class:"load-more-wrapper"},{default:o((()=>[V.value?(u(),d(j,{key:0,class:"btn-load-more",loading:T.value,onClick:Q},{default:o((()=>[n(i(T.value?"Loading...":"Load More History"),1)])),_:1},8,["loading"])):(u(),d(l,{key:1,class:"no-more-text"},{default:o((()=>[n("End of the journey.")])),_:1}))])),_:1})])),_:1})):T.value?(u(),d(m,{key:2,class:"loading-state"},{default:o((()=>[t(m,{class:"spinner"})])),_:1})):(u(),d(m,{key:1,class:"empty-state"},{default:o((()=>[t(m,{class:"empty-icon"},{default:o((()=>[n("üìÇ")])),_:1}),t(l,{class:"empty-text"},{default:o((()=>[n("No records found yet.")])),_:1}),t(j,{class:"btn-go",onClick:$},{default:o((()=>[n("Start Practicing")])),_:1})])),_:1}))])),_:1}),t(C),A.value?(u(),d(m,{key:0,class:"review-modal",onClick:v(z,["self"])},{default:o((()=>[t(m,{class:"modal-body"},{default:o((()=>[H.value?(u(),d(m,{key:0,class:"modal-loading"},{default:o((()=>[t(m,{class:"spinner"})])),_:1})):M.value?(u(),s(r,{key:1},[t(m,{class:"m-header"},{default:o((()=>[t(m,{class:"m-title-group"},{default:o((()=>[t(l,{class:f(["tag",M.value.record.is_correct?"success":"error"])},{default:o((()=>[n(i(M.value.record.is_correct?"Correct":"Mistake"),1)])),_:1},8,["class"]),t(l,{class:"title"},{default:o((()=>[n("Review Challenge")])),_:1})])),_:1}),t(m,{class:"btn-close",onClick:z},{default:o((()=>[n("‚úï")])),_:1})])),_:1}),t(D,{"scroll-y":"",class:"m-scroll-content"},{default:o((()=>[t(m,{class:"m-content"},{default:o((()=>[t(l,{class:"q-title"},{default:o((()=>[n(i(M.value.question.title),1)])),_:1}),t(m,{class:"component-wrapper"},{default:o((()=>["choice"===M.value.question.type?(u(),d(x,{key:0,options:M.value.question.content.options,modelValue:M.value.record.user_answer,"show-result":!0,"correct-answer":M.value.question.answer.correct_val},null,8,["options","modelValue","correct-answer"])):(u(),d(S,{key:1,code:M.value.question.content.code_snippet,lang:M.value.question.content.language,"gap-mode":M.value.question.content.gap_mode,"gap-options":M.value.question.content.gap_options,modelValue:M.value.record.user_answer,"show-result":!0,"correct-answer":M.value.question.answer.correct_val},null,8,["code","lang","gap-mode","gap-options","modelValue","correct-answer"]))])),_:1}),t(m,{class:"analysis-card"},{default:o((()=>[t(m,{class:"an-header"},{default:o((()=>[t(l,{class:"icon"},{default:o((()=>[n("üí°")])),_:1}),t(l,{class:"label"},{default:o((()=>[n("Analysis")])),_:1})])),_:1}),t(l,{class:"an-text"},{default:o((()=>[n(i(M.value.question.answer.analysis||"No analysis provided."),1)])),_:1})])),_:1})])),_:1})])),_:1})],64)):p("",!0)])),_:1})])),_:1})):p("",!0)])),_:1}),t(b)],64)}}},[["__scopeId","data-v-4ee37608"]]);export{F as default};
