import{r as a,E as e,H as l,b as s,w as t,i as u,a as c,f as n,h as r,l as o,e as d,B as v,m as i,n as f,j as _,k as p,F as g,s as y,J as h,K as m,G as k,p as b,S as w,q as C,L as x}from"./index-DwZjcXUC.js";import{o as I,a as q}from"./uni-app.es.CIFaVD21.js";import{Q as j,a as S}from"./QuizCodeGap.BJp0ikS-.js";import{g as A}from"./cloud.3QmAUTVe.js";import{_ as Q}from"./_plugin-vue_export-helper.BCo6x5W8.js";const V=Q({__name:"practice",setup(Q){const V=A("quiz-co"),z=a(!0),E=a([]),B=a(0),L=a([]),P=a([]),T=a({}),$=a(null),F=a(!1),G=a(!1),H=a(0),M=a(!1);let N=null;const U=e((()=>E.value[B.value])),Y=e((()=>L.value[B.value]||[])),D=e((()=>!0===P.value[B.value])),J=e((()=>(B.value+1)/E.value.length*100)),K=e((()=>{var a;return(null==(a=$.value)?void 0:a.is_correct)||!1})),O=e((()=>Object.values(T.value).filter((a=>a&&a.is_correct)).length)),W=e((()=>P.value.filter((a=>a)).length)),R=e((()=>E.value.length-W.value));l(B,(a=>{P.value[a]&&T.value[a]?$.value=T.value[a]:$.value=null}));const X=e((()=>D.value?B.value===E.value.length-1?"Finish":"Next Question":"Check Answer")),Z=e((()=>D.value?K.value?"btn-success":"btn-retry":""));I((a=>{a.categoryId&&aa(a.categoryId),a.startIndex&&(B.value=parseInt(a.startIndex))}));const aa=async a=>{try{const e=await V.getQuestionsByChapter(a);0===e.errCode&&(E.value=e.data,L.value=new Array(e.data.length).fill().map((()=>[])),P.value=new Array(e.data.length).fill(!1))}finally{z.value=!1}},ea=()=>{B.value<E.value.length-1&&B.value++},la=async()=>{if(D.value)B.value<E.value.length-1?B.value++:sa();else{if(0===Y.value.length)return y({title:"Please enter answer",icon:"none"});h({title:"Checking..."});try{const a=await V.checkAnswer(U.value._id,Y.value,H.value,"practice");0===a.errCode?($.value=a.data,P.value[B.value]=!0,T.value[B.value]=a.data,M.value||ca()):y({title:"Check failed",icon:"none"})}finally{m()}}},sa=()=>{R.value>0?(y({title:`You have ${R.value} unfinished questions`,icon:"none"}),F.value=!0):(M.value&&ca(),G.value=!0)},ta=()=>F.value=!F.value,ua=a=>{const e=[];if(a===B.value&&e.push("active-border"),P.value[a]){const l=T.value[a],s=l&&!0===l.is_correct;e.push(s?"correct":"wrong")}else e.push("todo");return e.join(" ")},ca=()=>{M.value?(clearInterval(N),M.value=!1):(M.value=!0,N=setInterval((()=>{H.value++}),1e3))},na=()=>{x(),N&&clearInterval(N),M.value=!1,H.value=0},ra=()=>{B.value>0&&(B.value--,$.value=null)},oa=()=>k(),da=()=>{B.value=0,L.value=L.value.map((()=>[])),P.value=P.value.map((()=>!1)),T.value={},$.value=null,H.value=0,G.value=!1,F.value=!1},va=a=>`${Math.floor(a/60).toString().padStart(2,"0")}:${(a%60).toString().padStart(2,"0")}`;return q((()=>{N&&clearInterval(N)})),(a,e)=>{const l=u,y=b,h=w,m=C;return c(),s(l,{class:"quiz-workspace"},{default:t((()=>[n(l,{class:"quiz-header"},{default:t((()=>[n(l,{class:"header-left",onClick:oa},{default:t((()=>[n(l,{class:"btn-close"},{default:t((()=>[r("Exit")])),_:1})])),_:1}),n(l,{class:"header-center"},{default:t((()=>[n(y,{class:"progress-text"},{default:t((()=>[r("Question "+o(B.value+1)+" / "+o(E.value.length),1)])),_:1}),n(l,{class:"progress-track"},{default:t((()=>[n(l,{class:"progress-fill",style:d({width:J.value+"%"})},null,8,["style"])])),_:1})])),_:1}),n(l,{class:"header-right"},{default:t((()=>[n(l,{class:"list-toggle",onClick:ta},{default:t((()=>[n(y,{class:"icon-list"},{default:t((()=>[r("â˜°")])),_:1}),n(y,{class:"list-text"},{default:t((()=>[r(o(W.value)+"/"+o(E.value.length),1)])),_:1})])),_:1}),n(l,{class:"timer-wrapper"},{default:t((()=>[H.value>0?(c(),s(l,{key:0,class:"reset-btn",onClick:v(na,["stop"])},{default:t((()=>[r("â†º")])),_:1})):i("",!0),n(l,{class:f(["timer-badge",{"is-running":M.value}]),onClick:ca},{default:t((()=>[n(y,{class:"timer-icon"},{default:t((()=>[r(o(M.value?"â¸":"â–¶ï¸"),1)])),_:1}),n(y,null,{default:t((()=>[r(o(va(H.value)),1)])),_:1})])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),z.value?(c(),s(l,{key:0,class:"loading-container"},{default:t((()=>[n(l,{class:"spinner"}),n(y,null,{default:t((()=>[r("Preparing your workspace...")])),_:1})])),_:1})):U.value?(c(),s(l,{key:1,class:"quiz-body"},{default:t((()=>[n(l,{class:"panel-context"},{default:t((()=>[n(h,{"scroll-y":"",class:"scroll-inner"},{default:t((()=>[n(l,{class:"context-content"},{default:t((()=>[n(l,{class:"tags-row"},{default:t((()=>[n(l,{class:f(["tag difficulty","lv-"+U.value.difficulty])},{default:t((()=>{return[r(o((a=U.value.difficulty,{1:"Easy",2:"Medium",3:"Hard"}[a]||"Easy")),1)];var a})),_:1},8,["class"]),n(l,{class:"tag type"},{default:t((()=>[r(o("code_gap"===U.value.type?"Code":"Choice"),1)])),_:1})])),_:1}),n(y,{class:"q-title"},{default:t((()=>[r(o(U.value.title),1)])),_:1})])),_:1})])),_:1})])),_:1}),n(l,{class:"panel-interaction"},{default:t((()=>[n(h,{"scroll-y":"",class:"scroll-inner"},{default:t((()=>[n(l,{class:"interaction-content"},{default:t((()=>{var a,u;return["choice"===U.value.type?(c(),s(j,{key:0,options:U.value.content.options,modelValue:L.value[B.value],"onUpdate:modelValue":e[0]||(e[0]=a=>L.value[B.value]=a),"show-result":D.value,"correct-answer":(null==(a=$.value)?void 0:a.correct_val)||[]},null,8,["options","modelValue","show-result","correct-answer"])):"code_gap"===U.value.type?(c(),s(S,{key:1,code:U.value.content.code_snippet,lang:U.value.content.language,"gap-mode":U.value.content.gap_mode,"gap-options":U.value.content.gap_options,modelValue:L.value[B.value],"onUpdate:modelValue":e[1]||(e[1]=a=>L.value[B.value]=a),"show-result":D.value,"correct-answer":(null==(u=$.value)?void 0:u.correct_val)||[]},null,8,["code","lang","gap-mode","gap-options","modelValue","show-result","correct-answer"])):i("",!0),D.value&&$.value?(c(),s(l,{key:2,class:f(["feedback-card",K.value?"success":"error"])},{default:t((()=>[n(l,{class:"fb-header"},{default:t((()=>[n(y,{class:"fb-icon"},{default:t((()=>[r(o(K.value?"ðŸŽ‰":"ðŸ¤”"),1)])),_:1}),n(y,{class:"fb-title"},{default:t((()=>[r(o(K.value?"Correct!":"Incorrect"),1)])),_:1})])),_:1}),n(y,{class:"fb-desc"},{default:t((()=>[r(o($.value.analysis||"No analysis provided."),1)])),_:1})])),_:1},8,["class"])):i("",!0)]})),_:1})])),_:1})])),_:1})])),_:1})):i("",!0),n(l,{class:"action-bar"},{default:t((()=>[n(l,{class:"bar-inner"},{default:t((()=>[n(l,{class:"btn-group"},{default:t((()=>[n(m,{class:"btn-secondary",onClick:ra,disabled:0===B.value},{default:t((()=>[r("Prev")])),_:1},8,["disabled"]),!D.value&&B.value<E.value.length-1?(c(),s(m,{key:0,class:"btn-secondary",onClick:ea},{default:t((()=>[r(" Skip ")])),_:1})):i("",!0),n(m,{class:f(["btn-primary",Z.value]),onClick:la},{default:t((()=>[r(o(X.value),1)])),_:1},8,["class"])])),_:1})])),_:1})])),_:1}),F.value?(c(),s(l,{key:2,class:"drawer-overlay",onClick:ta},{default:t((()=>[n(l,{class:"drawer-panel",onClick:e[2]||(e[2]=v((()=>{}),["stop"]))},{default:t((()=>[n(l,{class:"drawer-header"},{default:t((()=>[n(y,{class:"dh-title"},{default:t((()=>[r("Question List")])),_:1}),n(l,{class:"dh-stats"},{default:t((()=>[n(y,{class:"ds-item"},{default:t((()=>[n(y,{class:"dot green"}),r(" Correct")])),_:1}),n(y,{class:"ds-item"},{default:t((()=>[n(y,{class:"dot red"}),r(" Wrong")])),_:1}),n(y,{class:"ds-item"},{default:t((()=>[n(y,{class:"dot gray"}),r(" Todo")])),_:1})])),_:1})])),_:1}),n(h,{"scroll-y":"",class:"drawer-body"},{default:t((()=>[n(l,{class:"q-grid"},{default:t((()=>[(c(!0),_(g,null,p(E.value,((a,e)=>(c(),s(l,{class:f(["q-cell",ua(e)]),key:a._id,onClick:a=>(a=>{B.value=a,F.value=!1})(e)},{default:t((()=>[r(o(e+1)+" ",1),e===B.value?(c(),s(l,{key:0,class:"current-indicator"})):i("",!0)])),_:2},1032,["class","onClick"])))),128))])),_:1})])),_:1}),R.value>0?(c(),s(l,{key:0,class:"drawer-footer"},{default:t((()=>[n(y,{class:"warn-text"},{default:t((()=>[r("âš ï¸ You have "+o(R.value)+" unanswered questions.",1)])),_:1})])),_:1})):i("",!0)])),_:1})])),_:1})):i("",!0),G.value?(c(),s(l,{key:3,class:"result-modal"},{default:t((()=>[n(l,{class:"modal-backdrop"}),n(l,{class:"modal-content"},{default:t((()=>[n(l,{class:"modal-icon"},{default:t((()=>[r("ðŸ†")])),_:1}),n(y,{class:"modal-title"},{default:t((()=>[r("Session Complete!")])),_:1}),n(l,{class:"stats-grid"},{default:t((()=>[n(l,{class:"stat-box highlight"},{default:t((()=>[n(y,{class:"val"},{default:t((()=>[r(o(O.value)+" / "+o(E.value.length),1)])),_:1}),n(y,{class:"label"},{default:t((()=>[r("Correct Answers")])),_:1})])),_:1}),n(l,{class:"stat-box"},{default:t((()=>[n(y,{class:"val"},{default:t((()=>[r(o(va(H.value)),1)])),_:1}),n(y,{class:"label"},{default:t((()=>[r("Time Spent")])),_:1})])),_:1})])),_:1}),n(l,{class:"modal-actions"},{default:t((()=>[n(m,{class:"btn-outline",onClick:da},{default:t((()=>[r("Try Again")])),_:1}),n(m,{class:"btn-fill",onClick:oa},{default:t((()=>[r("Back to Library")])),_:1})])),_:1})])),_:1})])),_:1})):i("",!0)])),_:1})}}},[["__scopeId","data-v-460d6e55"]]);export{V as default};
